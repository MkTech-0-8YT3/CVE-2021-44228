FROM maven:3.6.0-jdk-11-slim AS builder
RUN mkdir /var/log4j
COPY . /var/log4j
RUN mvn -f /var/log4j/web/pom.xml clean install
RUN mvn -f /var/log4j/jndi/pom.xml clean install
RUN mvn -f /var/log4j/provider/pom.xml clean install

FROM openjdk:11-ea-11-jdk
RUN mkdir /var/log4j
COPY --from=builder /var/log4j/web/target/web-1.0.0.jar /var/log4j/web-1.0.0.jar
COPY --from=builder /var/log4j/jndi/target/jndi-1.0.0-jar-with-dependencies.jar /var/log4j/jndi-1.0.0-jar-with-dependencies.jar
COPY --from=builder /var/log4j/provider/target/provider-1.0.0.jar /var/log4j/provider-1.0.0.jar
COPY resources/docker/startup.sh /var/log4j/startup.sh
RUN chmod +x /var/log4j/startup.sh
EXPOSE 8080
EXPOSE 8081
ENTRYPOINT /var/log4j/startup.sh
